import{r as a,b as e}from"./vendor-9a24f32e.js";import{P as Ce}from"./PageContainer-9d3d18ee.js";import{b as q,a as z,T as j,c as me,j as te,h as ae,g as ne}from"./tabler-icons-react-fe0da12b.js";import{D as Ie}from"./DashboardCard-365a522d.js";import{u as W,b as A}from"./index-6fd738e1.js";import{u as de}from"./formik.esm-6723d0e7.js";import{c as ue,a as ge,b as pe,f as ye}from"./index.esm-41945323.js";import{V as H,B as w,m as p,I as B,W as L,X as he,Y as Ee,l as fe,a as N,d as R,Z as J,$ as U,a0 as X,a1 as Q,a2 as Z,a9 as Se,aa as G,ab as oe,G as $,J as F,ac as ve,ad as re,K as ke,a4 as Te,N as De,O as we,Q as V,R as _,U as Re,k as Me,S as Ae,p as Y,A as le,M as se}from"./mui-c7c5f84b.js";import{s as ce}from"./showtoast-e706062a.js";import"./IconCoin-68b6e027.js";import"./IconUser-373a8598.js";import"./IconChevronRight-c883d475.js";const Oe=m=>{const n=j[m];return n?e.createElement(n,null):e.createElement(z,null)},Be={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2},_e=ue({IconId:ge().required("Icon is required"),name:pe().required("Name is required")});function Ne({open:m,onClose:n,onCateAdded:v,CateId:C,cate:i}){const I=W(),[k,b]=a.useState([]),[u,E]=a.useState(!1),[T,g]=a.useState(""),[S,o]=a.useState(!0);a.useEffect(()=>{const l=localStorage.getItem("accessToken");if(!l){I("/auth/login");return}o(!0),A.get("http://localhost:3001/icon/view",{headers:{accessToken:l}}).then(c=>{b(c.data||[]),o(!1)}).catch(c=>{r(c)})},[I]);const r=l=>{const c=l.response&&l.response.data.message||l.message;console.error("Error:",c),g(c),E(!0)},t=de({initialValues:{name:(i==null?void 0:i.name)||"",IconId:(i==null?void 0:i.IconId)||"",is_income:(i==null?void 0:i.is_income)||!1},validationSchema:_e,enableReinitialize:!0,onSubmit:l=>{A.patch(`http://localhost:3001/cate/edit/${C}`,l,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(c=>{var D;if(c.data&&c.data.category){const O={...c.data.category,Icon:{icon_name:l.name,icon_class:((D=k.find(y=>y.id===l.IconId))==null?void 0:D.icon_class)||"IconHelp"}};v(O),n()}else r({message:"No category returned in response."})}).catch(c=>{r(c)})}});return e.createElement(H,{open:m,onClose:n},e.createElement(w,{sx:Be},e.createElement(p,{variant:"h6",component:"h2",gutterBottom:!0},"Edit Category"),e.createElement(B,{onClick:n,sx:{position:"absolute",top:16,right:16}},e.createElement(q,null)),S?e.createElement(p,null,"Loading data, please wait..."):e.createElement("form",{onSubmit:t.handleSubmit,className:"formContainer"},e.createElement(L,{fullWidth:!0,margin:"normal"},e.createElement(he,{name:"name",label:"Name",variant:"outlined",onChange:t.handleChange,value:t.values.name,error:t.touched.name&&!!t.errors.name,helperText:t.touched.name&&t.errors.name})),e.createElement(L,{fullWidth:!0,margin:"normal"},e.createElement(Ee,{id:"Icon"},"Icon"),e.createElement(fe,{name:"IconId",labelId:"Icon",variant:"outlined",label:"Icon",displayEmpty:!0,onChange:t.handleChange,value:t.values.IconId,error:t.touched.IconId&&!!t.errors.IconId},k.map(l=>e.createElement(N,{key:l.id,value:l.id},Oe(l.icon_class)," ",l.icon_name))),e.createElement("div",{style:{color:"red"}},t.touched.IconId&&t.errors.IconId)),e.createElement(R,{type:"submit",variant:"contained",color:"primary",fullWidth:!0},"Edit")),e.createElement(J,{open:u,onClose:()=>E(!1)},e.createElement(U,null,"Error"),e.createElement(X,null,e.createElement(Q,null,T)),e.createElement(Z,null,e.createElement(R,{onClick:()=>E(!1),color:"primary"},"OK")))))}const $e=m=>{const n=j[m];return n?e.createElement(n,null):e.createElement(z,null)},We={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2},Pe=ue({IconId:ge().required("Icon is required"),name:pe().required("Name is required"),is_income:ye().required("Type is required")});function Fe({open:m,onClose:n,onCateAdded:v}){const C=W(),[i,I]=a.useState([]),[k,b]=a.useState(!1),[u,E]=a.useState(""),[T,g]=a.useState(!0);a.useEffect(()=>{const r=localStorage.getItem("accessToken");if(!r){C("/auth/login");return}g(!0),A.get("http://localhost:3001/icon/view",{headers:{accessToken:r}}).then(t=>{I(t.data||[]),g(!1)}).catch(t=>{S(t)})},[C]);const S=r=>{const t=r.response&&r.response.data.message||r.message;console.error("Error:",t),E(t),b(!0)},o=de({initialValues:{name:"",IconId:"",is_income:null},validationSchema:Pe,onSubmit:r=>{A.post("http://localhost:3001/cate/",r,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(t=>{var l;if(t.data){const c={...t.data,Icon:{icon_name:r.name,icon_class:((l=i.find(D=>D.id===r.IconId))==null?void 0:l.icon_class)||"IconHelp"}};v(c),o.resetForm(),n()}else S({message:"No category returned in response."})}).catch(t=>{S(t)})}});return e.createElement(H,{open:m,onClose:n},e.createElement(w,{sx:We},e.createElement(p,{variant:"h6",component:"h2",gutterBottom:!0},"Add Category"),e.createElement(B,{onClick:n,sx:{position:"absolute",top:16,right:16}},e.createElement(q,null)),T?e.createElement(p,null,"Loading data, please wait..."):e.createElement("form",{onSubmit:o.handleSubmit,className:"formContainer"},e.createElement(L,{fullWidth:!0,margin:"normal"},e.createElement(he,{name:"name",label:"Name",variant:"outlined",onChange:o.handleChange,value:o.values.name,error:o.touched.name&&!!o.errors.name,helperText:o.touched.name&&o.errors.name})),e.createElement(L,{fullWidth:!0,margin:"normal"},e.createElement(Ee,{id:"Icon"},"Icon"),e.createElement(fe,{name:"IconId",labelId:"Icon",variant:"outlined",label:"Icon",displayEmpty:!0,onChange:o.handleChange,value:o.values.IconId,error:o.touched.IconId&&!!o.errors.IconId},i.map(r=>e.createElement(N,{key:r.id,value:r.id},$e(r.icon_class)," ",r.icon_name))),e.createElement("div",{style:{color:"red"}},o.touched.IconId&&o.errors.IconId)),e.createElement(L,{component:"fieldset",fullWidth:!0,margin:"normal"},e.createElement(p,{variant:"subtitle1"},"Type"),e.createElement(Se,{"aria-label":"is_income",name:"is_income",value:o.values.type,onChange:o.handleChange,error:o.touched.type&&!!o.errors.type},e.createElement(G,{value:!0,control:e.createElement(oe,null),label:"Income"}),e.createElement(G,{value:!1,control:e.createElement(oe,null),label:"Expense"})),o.touched.type&&o.errors.type&&e.createElement("div",{style:{color:"red"}},o.errors.type)),e.createElement(R,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,startIcon:e.createElement(me,null)},"Add")),e.createElement(J,{open:k,onClose:()=>b(!1)},e.createElement(U,null,"Error"),e.createElement(X,null,e.createElement(Q,null,u)),e.createElement(Z,null,e.createElement(R,{onClick:()=>b(!1),color:"primary"},"OK")))))}const Le={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:"600px",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2},qe=m=>{const n=j[m];return n?e.createElement(n,null):e.createElement(z,null)};function ze({open:m,onClose:n,CateId:v,onMigrationComplete:C,selectedTransactions:i}){const I=W(),[k,b]=a.useState([]),[u,E]=a.useState(""),[T,g]=a.useState(!1),[S,o]=a.useState("");a.useEffect(()=>{const t=localStorage.getItem("accessToken");if(!t){I("/auth/login");return}A.get(`http://localhost:3001/cate/someCate/${v}`,{headers:{accessToken:t}}).then(l=>b(l.data)).catch(l=>console.error("Error fetching categories:",l))},[I]);const r=async t=>{g(!0),o("");const l=localStorage.getItem("accessToken");if(!l){o("User is not authenticated"),g(!1);return}try{console.log(i);const c=i.map(D=>(console.log(D),A.patch(`http://localhost:3001/trans/edit/${D}`,{CategoryId:t},{headers:{accessToken:l}})));await Promise.all(c),g(!1),C(v)}catch(c){g(!1),o("An error occurred during the migration process"),console.error(c)}};return e.createElement(H,{open:m,onClose:n},e.createElement(w,{sx:Le},e.createElement(p,{variant:"h6",component:"h2",gutterBottom:!0},"Select a Category for the Chosen Transactions"),e.createElement(B,{onClick:n,sx:{position:"absolute",top:16,right:16}},e.createElement(q,null)),e.createElement(p,{variant:"body2",color:"textSecondary",mt:2},"Please select a category to assign to the chosen transactions."),e.createElement(w,{sx:{mt:2,mb:2}},e.createElement(p,{variant:"h6",gutterBottom:!0},"Select Category"),e.createElement($,{container:!0,spacing:2},k.map(t=>e.createElement($,{item:!0,xs:12,sm:6,md:4,key:t.id},e.createElement(F,{variant:u===t.id?"outlined":"elevation",sx:{cursor:"pointer",padding:2,border:u===t.id?"2px solid #3f51b5":"none"},onClick:()=>E(t.id)},e.createElement(ve,null,e.createElement(w,{display:"flex",flexDirection:"column",alignItems:"center"},qe(t.Icon.icon_class),e.createElement(p,{variant:"subtitle1",mt:1},t.name)))))))),e.createElement(w,{mt:2,display:"flex",justifyContent:"flex-end"},e.createElement(R,{onClick:()=>r(u),variant:"contained",color:"primary",disabled:!u},"Confirm"))))}const je={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:600,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2,overflowY:"auto",maxHeight:"80vh"};function He({open:m,onClose:n,CateId:v,onProcessing:C}){const i=W(),[I,k]=a.useState(0),[b,u]=a.useState([]),[E,T]=a.useState([]),[g,S]=a.useState(!1),[o,r]=a.useState(!1);a.useEffect(()=>{const s=localStorage.getItem("accessToken");if(!s){i("/auth/login");return}A.get(`http://localhost:3001/trans/count/${v}`,{headers:{accessToken:s}}).then(h=>{const{countT:f,cate:M}=h.data;k(Number(f));const P=t(M);JSON.stringify(P)!==JSON.stringify(b)&&u(P)}).catch(h=>{console.error("Error:",h)})},[v,i]);const t=s=>s.reduce((h,f)=>{const M=new Date(f.date).toLocaleDateString();return h[M]||(h[M]=[]),h[M].push(f),h},{}),l=s=>{const h=j[s];return h?e.createElement(h,null):e.createElement(z,null)},c=()=>{const s=g?[]:Object.values(b).flat().map(h=>h.id);T(s),S(!g)},D=s=>{r(!1),C(s)},O=s=>{const h=E.includes(s)?E.filter(f=>f!==s):[...E,s];T(h)},y=s=>{T(s),r(!0)};return e.createElement(H,{open:m,onClose:n},e.createElement(w,{sx:{...je,overflowY:"auto",maxHeight:"80vh"}},e.createElement(p,{variant:"h6",component:"h2",gutterBottom:!0},"Transfer Data Before Deleting Category"),e.createElement(B,{onClick:n,sx:{position:"absolute",top:16,right:16}},e.createElement(q,null)),I===0?e.createElement(p,null,"No transactions available for this category."):e.createElement(e.Fragment,null,e.createElement(p,{variant:"body2",color:"textSecondary",mt:2},I," transactions are linked to this category."),e.createElement(G,{control:e.createElement(re,{checked:g,onChange:c}),label:"Select All Transactions"}),e.createElement(ke,{component:Te,sx:{mt:2}},e.createElement(De,null,e.createElement(we,null,e.createElement(V,null,e.createElement(_,null),e.createElement(_,null))),e.createElement(Re,null,Object.keys(b).map((s,h)=>e.createElement(e.Fragment,{key:h},e.createElement(V,null,e.createElement(_,{colSpan:3,sx:{fontWeight:"bold"}},s)),b[s].map(f=>e.createElement(V,{key:f.id},e.createElement(_,{sx:{width:10}},e.createElement(re,{checked:E.includes(f.id),onChange:()=>O(f.id)})),e.createElement(_,{align:"left"},e.createElement(p,{variant:"subtitle1",color:"textPrimary"},l(f.Category.Icon.icon_class),f.remark?f.remark:f.Category.name)),e.createElement(_,{align:"right"},e.createElement(p,{variant:"subtitle1",color:"textPrimary"},f.type?"+":"-"," ",f.amount))))))))),e.createElement(w,{mt:2,display:"flex",justifyContent:"flex-end"},e.createElement(R,{onClick:()=>y(E),variant:"contained",color:"primary"},"Next Step")),e.createElement(ze,{open:o,onClose:()=>r(!1),CateId:v,selectedTransactions:E,onMigrationComplete:D}))))}const Ye={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2};function Ke({open:m,onClose:n,onCateDeleted:v,CateId:C}){const i=W(),[I,k]=a.useState(0),[b,u]=a.useState(!1),[E,T]=a.useState(""),[g,S]=a.useState(!1),[o,r]=a.useState(!1),[t,l]=a.useState(null);a.useEffect(()=>{const y=localStorage.getItem("accessToken");if(!y){i("/auth/login");return}S(!0),A.get(`http://localhost:3001/trans/count/${C}`,{headers:{accessToken:y}}).then(s=>{k(Number(s.data.countT))}).catch(s=>{c(s)}).finally(()=>{S(!1)})},[C,i]);const c=y=>{const s=y.response&&y.response.data.message||y.message;console.error("Error:",s),T(s),u(!0)},D=y=>{l(y),r(!0)},O=async()=>{r(!1),S(!0);try{await A.delete(`http://localhost:3001/cate/dlt/${C}`,{headers:{accessToken:localStorage.getItem("accessToken")}}),v(C),n()}catch(y){c(y)}finally{S(!1)}};return e.createElement(H,{open:m,onClose:n},e.createElement(w,{sx:Ye},e.createElement(p,{variant:"h6",component:"h2",gutterBottom:!0},"Delete Category"),e.createElement(B,{onClick:n,sx:{position:"absolute",top:16,right:16}},e.createElement(q,null)),I===0?e.createElement(e.Fragment,null,e.createElement(p,null,"Are you sure you want to delete this Category?"),e.createElement(w,{mt:2,display:"flex",justifyContent:"space-between"},e.createElement(R,{onClick:n,variant:"outlined",color:"secondary"},"Cancel"),e.createElement(R,{onClick:O,variant:"contained",color:"error",disabled:g},g?"Deleting...":"Delete"))):e.createElement(e.Fragment,null,e.createElement(p,null,"Are you sure you want to delete this category? Deleting this category will also remove all transactions associated with it."),e.createElement(w,{mt:2,display:"flex",justifyContent:"space-between"},e.createElement(R,{onClick:()=>D(C),variant:"outlined",color:"secondary"},"Transfer Data"),e.createElement(R,{onClick:O,variant:"contained",color:"error",disabled:g},g?"Deleting...":"Delete"))),e.createElement(J,{open:b,onClose:()=>u(!1)},e.createElement(U,null,"Error"),e.createElement(X,null,e.createElement(Q,null,E)),e.createElement(Z,null,e.createElement(R,{onClick:()=>u(!1),color:"primary"},"OK"))),e.createElement(He,{open:o,onClose:()=>r(!1),CateId:t,onProcessing:O})))}const ie=m=>{const n=j[m];return n?e.createElement(n,null):e.createElement(z,null)},rt=()=>{const[m,n]=a.useState(null),[v,C]=a.useState(null),[i,I]=a.useState([]),[k,b]=a.useState([]),[u,E]=a.useState(null),[T,g]=a.useState(null),[S,o]=a.useState(null),[r,t]=a.useState(!1),[l,c]=a.useState(!1),[D,O]=a.useState(!1),[y,s]=a.useState("");let h=W();a.useEffect(()=>{const x=localStorage.getItem("accessToken");if(!x){h("/auth/login");return}A.get("http://localhost:3001/cate/viewAll",{headers:{accessToken:x}}).then(d=>{d.data&&(I(d.data.cateincome),b(d.data.cateexpense))}).catch(d=>{setErrorMsg(d.message)})},[h]);const f=x=>{A.get("http://localhost:3001/cate/viewAll",{headers:{accessToken:localStorage.getItem("accessToken")}}).then(d=>{d.data&&(I(d.data.cateincome),b(d.data.cateexpense),ce("Successful!"))}).catch(d=>{d.response?setErrorMsg(d.response.data.message):setErrorMsg("Server Error")})},M=()=>{n(null),C(null),s(null)},P=(x,d)=>{o(d),g(x),M(),t(!0)},be=()=>{c(!0)},ee=x=>{g(x),M(),O(!0)},xe=x=>{I(i.filter(d=>d.id!==x)),b(k.filter(d=>d.id!==x)),M(),ce("Delete Successful!")};return e.createElement(Ce,{title:"Category",description:"Category Page",sx:{background:"linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%)",minHeight:"100vh"}},e.createElement(Ie,{title:"Categories",sx:{backgroundColor:"transparent"}},e.createElement(Me,null,e.createElement(Ae,{direction:"row",justifyContent:"flex-end",mb:4},e.createElement(R,{variant:"contained",color:"primary",onClick:()=>be(),startIcon:e.createElement(me,{size:"20"}),sx:{borderRadius:"8px",textTransform:"none",boxShadow:3,"&:hover":{boxShadow:4}}},"New Category")),e.createElement(F,{variant:"outlined",sx:{mb:4,borderRadius:"16px",border:"1px solid rgba(33, 150, 243, 0.1)"}},e.createElement(Y,null,e.createElement(p,{variant:"h6",gutterBottom:!0,sx:{color:"#1976D2",fontWeight:600,display:"flex",alignItems:"center","&::before":{content:'""',width:"4px",height:"24px",backgroundColor:"#1976D2",marginRight:"12px",borderRadius:"4px"}}},"Income Categories"),e.createElement(w,{mt:2}),e.createElement($,{container:!0,spacing:2},i.map((x,d)=>e.createElement($,{item:!0,xs:12,sm:6,md:3,key:d},e.createElement(F,{variant:"outlined",sx:{transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:"0 4px 20px rgba(33, 150, 243, 0.2)"},borderRadius:"12px",border:"1px solid rgba(33, 150, 243, 0.2)"}},e.createElement(Y,{sx:{position:"relative",padding:"16px !important"}},e.createElement(B,{sx:{position:"absolute",top:8,right:8,"&:hover":{backgroundColor:"rgba(33, 150, 243, 0.1)"}},"aria-label":"settings",onClick:K=>{n(K.currentTarget),E(x)}},e.createElement(te,null)),e.createElement(le,{sx:{margin:"0 auto 12px",backgroundColor:"rgba(33, 150, 243, 0.1)",color:"#1976D2",width:56,height:56}},ie(x.Icon.icon_class)),e.createElement(p,{variant:"subtitle1",align:"center",sx:{fontWeight:500,color:"#1976D2"}},x.name),e.createElement(se,{anchorEl:m,open:!!m,onClose:M,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{elevation:3,sx:{minWidth:150,borderRadius:"8px","& .MuiMenuItem-root":{px:2,py:1,borderRadius:"4px",mx:1,my:.5}}}},e.createElement(N,{onClick:()=>P(u.id,u),sx:{"&:hover":{backgroundColor:"rgba(33, 150, 243,  0.1)"}}},e.createElement(ae,{size:18,style:{marginRight:8}}),"Edit"),e.createElement(N,{onClick:()=>ee(u),sx:{color:"error.main","&:hover":{backgroundColor:"rgba(40, 53, 147, 0.1)"}}},e.createElement(ne,{size:18,style:{marginRight:8}}),"Delete"))))))))),e.createElement(F,{variant:"outlined",sx:{mb:4,borderRadius:"16px",border:"1px solid rgba(40, 53, 147, 0.1)"}},e.createElement(Y,null,e.createElement(p,{variant:"h6",gutterBottom:!0,sx:{color:"#283593",fontWeight:600,display:"flex",alignItems:"center","&::before":{content:'""',width:"4px",height:"24px",backgroundColor:"#283593",marginRight:"12px",borderRadius:"4px"}}},"Expense Categories"),e.createElement(w,{mt:2}),e.createElement($,{container:!0,spacing:2},k.map((x,d)=>e.createElement($,{item:!0,xs:12,sm:6,md:3,key:d},e.createElement(F,{variant:"outlined",sx:{transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:"0 4px 20px rgba(40, 53, 147, 0.2)"},borderRadius:"12px",border:"1px solid rgba(40, 53, 147, 0.2)"}},e.createElement(Y,{sx:{position:"relative",padding:"16px !important"}},e.createElement(B,{sx:{position:"absolute",top:8,right:8,"&:hover":{backgroundColor:"rgba(40, 53, 147, 0.1)"}},"aria-label":"settings",onClick:K=>{n(K.currentTarget),E(x)}},e.createElement(te,null)),e.createElement(le,{sx:{margin:"0 auto 12px",backgroundColor:"rgba(40, 53, 147, 0.1)",color:"#283593",width:56,height:56}},ie(x.Icon.icon_class)),e.createElement(p,{variant:"subtitle1",align:"center",sx:{fontWeight:500,color:"#283593"}},x.name),e.createElement(se,{anchorEl:m,open:!!m,onClose:M,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{elevation:3,sx:{minWidth:150,borderRadius:"8px","& .MuiMenuItem-root":{px:2,py:1,borderRadius:"4px",mx:1,my:.5}}}},e.createElement(N,{onClick:()=>P(u.id,u),sx:{"&:hover":{backgroundColor:"rgba(40, 53, 147,  0.1)"}}},e.createElement(ae,{size:18,style:{marginRight:8}}),"Edit"),e.createElement(N,{onClick:()=>ee(u.id),sx:{color:"error.main","&:hover":{backgroundColor:"rgba(33, 150, 243, 0.1)"}}},e.createElement(ne,{size:18,style:{marginRight:8}}),"Delete")))))))),e.createElement(Ne,{open:r,onClose:()=>t(!1),onCateAdded:f,CateId:T,cate:S}),e.createElement(Fe,{open:l,onClose:()=>c(!1),onCateAdded:f}),e.createElement(Ke,{open:D,onClose:()=>O(!1),onCateDeleted:xe,CateId:T})))))};export{rt as default};
