import{r as a,b as e}from"./vendor-9a24f32e.js";import{P as G}from"./PageContainer-9d3d18ee.js";import{D as H}from"./DashboardCard-365a522d.js";import{d as U,A as Z,u as _,b as P}from"./index-6fd738e1.js";import{c as j,b as x,e as X}from"./index.esm-41945323.js";import{s as N}from"./showtoast-e706062a.js";import{a4 as J,m as K,G as o,X as n,B as R,d as m,Z as Q,$ as V,a0 as Y,a5 as ee,a6 as te,a2 as ae}from"./mui-c7c5f84b.js";const de=()=>{const[l,E]=a.useState(""),[d,v]=a.useState(""),[k,T]=a.useState(""),{id:p}=U(),[I,c]=a.useState(null),[A,i]=a.useState("info"),{authState:M,setAuthState:$,updateName:se}=a.useContext(Z),[q,f]=a.useState(!1),[h,D]=a.useState(""),[g,B]=a.useState(""),S=_(),[L,w]=a.useState(!1),[re,r]=a.useState(null),[y,u]=a.useState(!1);a.useState(null),a.useEffect(()=>{if(!localStorage.getItem("accessToken")){S("auth/login");return}P.get(`http://localhost:3001/auth/profile/${p}`,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(t=>{E(t.data.fName),v(t.data.lName),T(t.data.email)}).catch(t=>{r(t.message)})},[S]);const O=async()=>{if(u(!0),!l||!d){r("First name and last name are required."),u(!1);return}try{if((await P.patch(`http://localhost:3001/auth/edit/${p}`,{fname:l,lname:d},{headers:{accessToken:localStorage.getItem("accessToken")}})).status===200){const s={...M,fname:l};$(s),setTimeout(()=>{u(!1)},500),N("Successful!")}}catch(t){t.response?r(t.response.data.error||"An error occurred."):t.request?r("No response from server."):r("Error: "+t.message),u(!1)}},W=j().shape({newPassword:x().min(12,"Password must be at least 12 characters long").matches(/(?=.*[A-Z])/,"Password must contain at least one uppercase letter").matches(/(?=.*[a-z])/,"Password must contain at least one lowercase letter").matches(/(?=.*\d)/,"Password must contain at least one number").matches(/(?=.*[@$!%*?&])/,"Password must contain at least one special character (@, $, !, %, *, ?, &)").required("Password is required"),confirmPassword:x().oneOf([X("newPassword"),null],"Passwords must match").required("Confirm Password is required")}),C=()=>{w(!1)},F=()=>{try{W.validateSync({newPassword:h,confirmPassword:g})}catch(s){c(s.errors?s.errors[0]:s.message),i("error"),w(!0);return}const t={password:h,confirmPassword:g};P.put(`http://localhost:3001/auth/pass/${p}`,t,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(s=>{s.data,f(!1),N("Password Change Successful!")}).catch(s=>{s.response?(c(s.response.data),i("error")):s.request?(c("No response received from the server."),i("warning")):(c("Error: "+s.message),i("error")),w(!0)})},z=()=>{f(!0)},b=()=>{f(!1)};return e.createElement(G,{title:"User Profile",description:"Manage your profile information"},e.createElement(H,{title:"User Profile"},e.createElement(J,{elevation:3,sx:{padding:3,borderRadius:2}},e.createElement(K,{variant:"h5",gutterBottom:!0},"Edit Profile"),e.createElement(o,{container:!0,spacing:2},e.createElement(o,{item:!0,xs:12,sm:6},e.createElement(n,{fullWidth:!0,label:"First Name",variant:"outlined",value:l,onChange:t=>E(t.target.value),InputProps:{style:{borderRadius:8}}})),e.createElement(o,{item:!0,xs:12,sm:6},e.createElement(n,{fullWidth:!0,label:"Last Name",variant:"outlined",value:d,onChange:t=>v(t.target.value),InputProps:{style:{borderRadius:8}}})),e.createElement(o,{item:!0,xs:12,sm:6},e.createElement(n,{fullWidth:!0,label:"Email",variant:"outlined",value:k,InputProps:{style:{borderRadius:8}},disabled:!0})),e.createElement(o,{item:!0,xs:12},e.createElement(R,{sx:{display:"flex",justifyContent:"flex-end",gap:2}},e.createElement(m,{variant:"contained",color:"primary",onClick:O,disabled:y},y?"Saving...":"Save"),e.createElement(m,{variant:"outlined",color:"primary",onClick:z},"Reset Password")))))),e.createElement(Q,{open:q,onClose:b},e.createElement(V,null,"Reset Password"),e.createElement(Y,null,e.createElement(ee,{open:L,autoHideDuration:6e3,onClose:C,anchorOrigin:{vertical:"top",horizontal:"center"}},e.createElement(te,{onClose:C,severity:A,sx:{width:"100%"}},e.createElement("span",{dangerouslySetInnerHTML:{__html:I}}))),e.createElement(R,{mt:2}),e.createElement(n,{fullWidth:!0,label:"New Password",type:"password",variant:"outlined",value:h,onChange:t=>D(t.target.value),InputProps:{style:{borderRadius:8}},sx:{marginBottom:2}}),e.createElement(n,{fullWidth:!0,label:"Confirm New Password",type:"password",variant:"outlined",value:g,onChange:t=>B(t.target.value),InputProps:{style:{borderRadius:8}}})),e.createElement(ae,null,e.createElement(m,{onClick:b,color:"secondary"},"Cancel"),e.createElement(m,{onClick:F,color:"primary"},"Reset Password"))))};export{de as default};
