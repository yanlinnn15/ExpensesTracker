import{r as a,b as e}from"./vendor-9a24f32e.js";import{b as re,c as le,a as oe,T as se,d as ve,e as De,f as we,g as Me}from"./tabler-icons-react-fe0da12b.js";import{g as Re}from"./func12m-131c3f32.js";import{P as $e}from"./PageContainer-9d3d18ee.js";import{D as Oe}from"./DashboardCard-365a522d.js";import{u as z,b as R,a as Le,c as Y}from"./index-6fd738e1.js";import Ae from"./addtrans-52b90434.js";import{u as Be}from"./formik.esm-6723d0e7.js";import{c as Pe,a as qe,b as J,d as We}from"./index.esm-41945323.js";import{V as ce,B as C,m as g,I as G,W as P,X as K,Y as Fe,l as je,a as W,d as v,Z as ie,$ as me,a0 as de,a1 as ue,a2 as Ee,S as Ne,k as Z,G as w,J as ee,p as te,M as ae,K as Ue,N as _e,U as Ke,Q as q,R as M,L as ne,a3 as ze}from"./mui-c7c5f84b.js";import"./IconCoin-68b6e027.js";import"./IconUser-373a8598.js";import"./IconChevronRight-c883d475.js";import"./addexpense-c619d23e.js";const Ge=s=>{const o=se[s];return o?e.createElement(o,null):e.createElement(oe,null)},He={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2};(()=>{const s=new Date,o=s.getFullYear(),y=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0");return`${o}-${y}-${u}`})();const Qe=Pe({amount:qe().required("Required").min(.1,"Must be at least 0.1"),remark:J().optional(),CategoryId:J().required("Required"),date:We().required("Required")});function Ve({open:s,onClose:o,onExpenseAdded:y,transactionId:u,transaction:E}){const b=z(),[h,S]=a.useState([]),[L,I]=a.useState(null),[D,x]=a.useState(!1),[A,i]=a.useState(""),[T,B]=a.useState(!0);a.useEffect(()=>{const l=localStorage.getItem("accessToken");if(!l){b("/auth/login");return}B(!0),Promise.all([R.get("http://localhost:3001/cate/viewAll",{headers:{accessToken:l}}),R.get(`http://localhost:3001/trans/view/${u}`,{headers:{accessToken:l}})]).then(([d,f])=>{S(d.data.cate),I(f.data)}).catch(d=>{$(d)}).finally(()=>{B(!1)})},[b,u]);const $=l=>{const d=l.response&&l.response.data.message||l.message;i(d),x(!0)},n=Be({initialValues:{amount:E.amount,remark:E.remark,CategoryId:E.CategoryId,date:E.date},validationSchema:Qe,enableReinitialize:!0,onSubmit:l=>{R.patch(`http://localhost:3001/trans/edit/${u}`,l,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(d=>{const f=h.find(j=>j.id===l.CategoryId),F={...d.data.transaction,Category:{name:(f==null?void 0:f.name)||"Unknown",Icon:(f==null?void 0:f.Icon)||{icon_class:"IconHelp"}}};y(F),o()}).catch(d=>{$(d)})}});return e.createElement(ce,{open:s,onClose:o},e.createElement(C,{sx:He},e.createElement(g,{variant:"h6",component:"h2",gutterBottom:!0},"Edit Transaction"),e.createElement(G,{onClick:o,sx:{position:"absolute",top:16,right:16}},e.createElement(re,null)),T?e.createElement(g,null,"Loading data, please wait..."):e.createElement("form",{onSubmit:n.handleSubmit,className:"formContainer"},e.createElement(P,{fullWidth:!0,margin:"normal"},e.createElement(K,{name:"amount",type:"number",label:"Amount",variant:"outlined",onChange:n.handleChange,value:n.values.amount,error:n.touched.amount&&!!n.errors.amount,helperText:n.touched.amount&&n.errors.amount})),e.createElement(P,{fullWidth:!0,margin:"normal"},e.createElement(Fe,{id:"CategoryId"},"Category"),e.createElement(je,{name:"CategoryId",labelId:"CategoryId",variant:"outlined",label:"Category",displayEmpty:!0,onChange:n.handleChange,value:n.values.CategoryId,error:n.touched.CategoryId&&!!n.errors.CategoryId},h.map(l=>e.createElement(W,{key:l.id,value:l.id},Ge(l.Icon.icon_class)," ",l.name?l.name:l.Icon.icon_name))),e.createElement("div",{style:{color:"red"}},n.touched.CategoryId&&n.errors.CategoryId)),e.createElement(P,{fullWidth:!0,margin:"normal"},e.createElement(K,{name:"date",type:"date",label:"Date",variant:"outlined",InputLabelProps:{shrink:!0},onChange:n.handleChange,value:n.values.date,error:n.touched.date&&!!n.errors.date,helperText:n.touched.date&&n.errors.date})),e.createElement(P,{fullWidth:!0,margin:"normal"},e.createElement(K,{name:"remark",label:"Remark (optional)",variant:"outlined",onChange:n.handleChange,value:n.values.remark})),e.createElement(v,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,startIcon:e.createElement(le,null)},"Edit")),e.createElement(ie,{open:D,onClose:()=>x(!1)},e.createElement(me,null,"Error"),e.createElement(de,null,e.createElement(ue,null,A)),e.createElement(Ee,null,e.createElement(v,{onClick:()=>x(!1),color:"primary"},"OK")))))}const Xe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2};function Ye({open:s,onClose:o,onTransactionDeleted:y,transactionId:u}){const E=z(),[b,h]=a.useState(!1),[S,L]=a.useState(""),[I,D]=a.useState(!1);a.useEffect(()=>{localStorage.getItem("accessToken")||E("/auth/login")},[E]);const x=i=>{const T=i.response&&i.response.data.message||i.message;console.error("Error:",T),L(T),h(!0)},A=async()=>{D(!0);try{const i=await R.delete(`http://localhost:3001/trans/dlt/${u}`,{headers:{accessToken:localStorage.getItem("accessToken")}});y(u),o()}catch(i){x(i)}finally{D(!1)}};return e.createElement(ce,{open:s,onClose:o},e.createElement(C,{sx:Xe},e.createElement(g,{variant:"h6",component:"h2",gutterBottom:!0},"Delete Transaction"),e.createElement(G,{onClick:o,sx:{position:"absolute",top:16,right:16}},e.createElement(re,null)),e.createElement(g,null,"Are you sure you want to delete this transaction?"),e.createElement(C,{mt:2,display:"flex",justifyContent:"space-between"},e.createElement(v,{onClick:o,variant:"outlined",color:"secondary"},"Cancel"),e.createElement(v,{onClick:A,variant:"contained",color:"error",disabled:I},I?"Deleting...":"Delete")),e.createElement(ie,{open:b,onClose:()=>h(!1)},e.createElement(me,null,"Error"),e.createElement(de,null,e.createElement(ue,null,S)),e.createElement(Ee,null,e.createElement(v,{onClick:()=>h(!1),color:"primary"},"OK")))))}const Je=s=>{const o=se[s];return o?e.createElement(o,null):e.createElement(oe,null)},[Ze,et]=Re(),gt=()=>{const[s,o]=a.useState(null),[y,u]=a.useState(null),[E,b]=a.useState(et),[h,S]=a.useState([]),[L,I]=a.useState("0.00"),[D,x]=a.useState("0.00"),[A,i]=a.useState(""),T=z();a.useState(!1),a.useState(!1);const[B,$]=a.useState(!1),[n,l]=a.useState(null),[d,f]=a.useState(null),[F,j]=a.useState([]),[pe,H]=a.useState(!1),[ge,Q]=a.useState(!1),he=()=>Q(!0),fe=()=>Q(!1),xe=Le(),Ce=()=>new URLSearchParams(xe.search),ye=(t,c)=>{f(c),o(t.currentTarget)},N=()=>{o(null)},U=t=>{const c=t.date.slice(0,7);b(c),R.get(`${Y}/trans/viewAll?mth=${E}`,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(r=>{if(r.data){const p=r.data.transaction.reduce((m,O)=>{const k=O.date;return m[k]||(m[k]={date:k,transactions:[]}),m[k].transactions.push(O),m},{});S(Object.values(p)),I(r.data.ttlIncome),x(r.data.ttlExpense)}}).catch(r=>{r.response?i(r.response.data.message):i("Server Error")})},be=t=>{u(t.currentTarget)},Ie=t=>{b(t),u(null)},Se=(t,c)=>{j(c),l(t),N(),$(!0)},Te=t=>{l(t),N(),H(!0)},ke=t=>{let c=0,r="";S(p=>p.reduce((O,k)=>{const V=k.transactions.filter(_=>{const X=String(_.id)===String(t);return X&&(c=_.amount,r=_.type),!X});return V.length>0&&O.push({...k,transactions:V}),O},[])),r===!0?I(p=>(p-c).toFixed(2)):x(p=>(p-c).toFixed(2))};return a.useEffect(()=>{const c=Ce().get("mth");c&&b(c)},[]),a.useEffect(()=>{localStorage.getItem("accessToken")?R.get(`${Y}/trans/viewAll?mth=${E}`,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(t=>{if(t.data){const c=t.data.transaction.reduce((r,p)=>{const m=p.date;return r[m]||(r[m]={date:m,transactions:[]}),r[m].transactions.push(p),r},{});S(Object.values(c)),I(t.data.ttlIncome),x(t.data.ttlExpense)}else alert("Unexpected response format. Please try again.")}).catch(t=>{t.response?i(t.response.data.message):i("Server Error")}):T("/auth/login")},[E,T]),e.createElement($e,{title:"Transactions",description:"Balance Page"},e.createElement(Oe,{title:"Transactions"},e.createElement(Ne,{direction:"row",justifyContent:"flex-end",mb:4},e.createElement(v,{variant:"contained",color:"primary",onClick:he,startIcon:e.createElement(le,{size:"20"}),sx:{borderRadius:"8px",textTransform:"none",boxShadow:3,"&:hover":{boxShadow:4}}},"New Transaction")),e.createElement(Z,{maxWidth:"lg"},e.createElement(w,{container:!0,spacing:3},e.createElement(w,{item:!0,xs:12},e.createElement(ee,{variant:"outlined",sx:{backgroundColor:"transparent"}},e.createElement(te,{sx:{backgroundColor:"primary.main",borderRadius:2,p:2}},e.createElement(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e.createElement(w,{container:!0,spacing:3},e.createElement(w,{item:!0,xs:4},e.createElement(C,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start"}},e.createElement(g,{variant:"h6",sx:{color:"white",mr:1}},E),e.createElement(v,{onClick:be,sx:{minWidth:0,padding:0,color:"white","&:hover":{color:"secondary.main"}}},e.createElement(ve,null)))),e.createElement(w,{item:!0,xs:4},e.createElement(C,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},e.createElement(g,{sx:{mb:1,color:"lightgrey"}},"Total Expense"),e.createElement(g,{variant:"h6",sx:{color:"white"}},"RM ",D))),e.createElement(w,{item:!0,xs:4},e.createElement(C,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},e.createElement(g,{sx:{mb:1,color:"lightgrey"}},"Total Income"),e.createElement(g,{variant:"h6",sx:{color:"white"}},"RM ",L))))),e.createElement(ae,{anchorEl:y,open:!!y,onClose:()=>u(null)},Ze.map(t=>e.createElement(W,{key:t,onClick:()=>Ie(t)},t)))))))),e.createElement(C,{mt:2}),e.createElement(Z,null,e.createElement(ee,{variant:"outlined"},e.createElement(Ue,null,e.createElement(_e,{"aria-label":"transactions table"},e.createElement(Ke,null,h.length===0?e.createElement(q,null,e.createElement(M,{colSpan:3,align:"center"},e.createElement(te,null,"No transaction."))):h.map((t,c)=>e.createElement(e.Fragment,{key:t.date},e.createElement(q,null,e.createElement(M,{colSpan:3,sx:{py:1}},t.date)),t.transactions.map((r,p)=>e.createElement(q,{key:r.id},e.createElement(M,null,e.createElement(C,{display:"flex",alignItems:"center"},Je(r.Category.Icon.icon_class),e.createElement(g,{variant:"subtitle1",color:"textPrimary",sx:{ml:1}},r.remark?r.remark:r.Category.name))),e.createElement(M,null,e.createElement(g,{variant:"subtitle1",color:"textPrimary"},r.type?"+":"-"," ",r.amount)),e.createElement(M,{align:"right"},e.createElement(G,{id:"basic-button","aria-controls":s?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:m=>ye(m,r)},e.createElement(De,{width:18})),e.createElement(ae,{id:"basic-menu",anchorEl:s,open:!!s,onClose:N,MenuListProps:{"aria-labelledby":"basic-button"}},e.createElement(W,{onClick:()=>{Se(d.id,d)}},e.createElement(ne,null,e.createElement(we,{width:18})),"Edit"),e.createElement(W,{onClick:()=>{Te(d.id)}},e.createElement(ne,null,e.createElement(Me,{width:18})),"Delete"))))),c<h.length-1&&e.createElement(q,null,e.createElement(M,{colSpan:3},e.createElement(ze,null)))))),e.createElement(Ve,{open:B,onClose:()=>$(!1),onExpenseAdded:U,transactionId:n,transaction:F}),e.createElement(Ye,{open:pe,onClose:()=>H(!1),onTransactionDeleted:ke,transactionId:n}),e.createElement(Ae,{open:ge,onClose:fe,getExpense:U,getIncome:U})))))))};export{gt as default};
