import{r as l,b as e}from"./vendor-9a24f32e.js";import{P as ae}from"./PageContainer-9d3d18ee.js";import{D as oe}from"./DashboardCard-365a522d.js";import{C as ne}from"./react-apexcharts.min-717a880d.js";import{u as W,b as S}from"./index-6fd738e1.js";import{u as U}from"./formik.esm-6723d0e7.js";import{c as Z,a as O,b as re}from"./index.esm-41945323.js";import{b as z,c as P,a as le,T as se,h as ce,g as ie,i as me}from"./tabler-icons-react-fe0da12b.js";import{S as de,s as Y}from"./showtoast-e706062a.js";import{V as $,B as k,m as h,I as F,W as w,Y as ue,l as ge,a as G,X as L,d as I,Z as pe,$ as he,a0 as Ee,a1 as fe,a2 as be,u as Ce,k as ye,S as X,G as T,J,p as K,a7 as Se,A as ke}from"./mui-c7c5f84b.js";import"./IconCoin-68b6e027.js";import"./IconUser-373a8598.js";import"./IconChevronRight-c883d475.js";function Q(u,r,E="info",g="Okay"){return de.fire({title:u,text:r,icon:E,confirmButtonText:g})}const Ie=u=>{const r=se[u];return r?e.createElement(r,null):e.createElement(le,null)},ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2},xe=Z({CategoryId:O().required("Category is required"),amount:O().required("Amount is required").positive("Enter a valid number").typeError("Amount must be a valid number")});function Be({open:u,onClose:r,onBudgetAdded:E}){const g=W(),[i,p]=l.useState([]),[f,C]=l.useState(!1),[b,o]=l.useState(""),[m,d]=l.useState(!0);l.useEffect(()=>{const c=localStorage.getItem("accessToken");if(!c){g("/auth/login");return}d(!0),S.get("http://localhost:3001/cate/viewAll",{headers:{accessToken:c}}).then(n=>{p(n.data.catebudget||[]),d(!1)}).catch(n=>{y(n)})},[g,u]);const y=c=>{const n=c.response&&c.response.data.message||c.message;Q("Error",n,"error")},s=U({initialValues:{CategoryId:"",amount:"",remark:""},validationSchema:xe,onSubmit:c=>{S.post("http://localhost:3001/budget/",c,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(n=>{var v,D,N,x,B,R,M;if(n.data){const _={...n.data,Icon:{icon_name:((v=n.data.Category)==null?void 0:v.Icon.icon_name)||"IconHelp",icon_class:((D=n.data.Category)==null?void 0:D.Icon.icon_class)||"IconHelp"},Category:{id:n.data.CategoryId,name:((N=n.data.Category)==null?void 0:N.name)||"Unknown",is_income:((x=n.data.Category)==null?void 0:x.is_income)||!1,IconId:((B=n.data.Category)==null?void 0:B.IconId)||null,Icon:{icon_name:((R=n.data.Category)==null?void 0:R.Icon.icon_name)||"IconHelp",icon_class:((M=n.data.Category)==null?void 0:M.Icon.icon_class)||"IconHelp"}},totalSpent:n.data.totalSpent||0};E(_),s.resetForm(),r()}else y({message:"No Budget returned in response."})}).catch(n=>{y(n)})}});return e.createElement($,{open:u,onClose:r},e.createElement(k,{sx:ve},e.createElement(h,{variant:"h6",component:"h2",gutterBottom:!0},"Add Budget"),e.createElement(F,{onClick:r,sx:{position:"absolute",top:16,right:16}},e.createElement(z,null)),m?e.createElement(h,null,"Loading data, please wait..."):e.createElement("form",{onSubmit:s.handleSubmit,className:"formContainer"},e.createElement(w,{fullWidth:!0,margin:"normal"},e.createElement(ue,{id:"CategoryId"},"Category"),e.createElement(ge,{name:"CategoryId",labelId:"CategoryId",label:"Category",displayEmpty:!0,variant:"outlined",inputProps:{"aria-label":"Category"},onChange:s.handleChange,value:s.values.CategoryId,error:s.touched.CategoryId&&!!s.errors.CategoryId},i.length===0?e.createElement(G,{disabled:!0},"No categories found or all categories assigned"):i.map(c=>e.createElement(G,{key:c.id,value:c.id},Ie(c.Icon.icon_class)," ",c.name))),s.touched.CategoryId&&s.errors.CategoryId&&e.createElement("div",{style:{color:"red",fontSize:"0.875rem"}},s.errors.CategoryId)),e.createElement(w,{fullWidth:!0,margin:"normal"},e.createElement(L,{name:"amount",type:"number",label:"Amount",variant:"outlined",onChange:s.handleChange,value:s.values.amount,error:s.touched.amount&&!!s.errors.amount,helpertext:s.touched.amount&&s.errors.amount,inputProps:{"aria-label":"Amount"}})),e.createElement(w,{fullWidth:!0,margin:"normal"},e.createElement(L,{name:"remark",label:"Remark (optional)",variant:"outlined",onChange:s.handleChange,value:s.values.remark,inputProps:{"aria-label":"Remark"}})),e.createElement(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,startIcon:e.createElement(P,null)},"Add")),e.createElement(pe,{open:f,onClose:()=>C(!1)},e.createElement(he,null,"Error"),e.createElement(Ee,null,e.createElement(fe,null,b)),e.createElement(be,null,e.createElement(I,{onClick:()=>C(!1),color:"primary"},"OK")))))}const Ae=Z({amount:O().required("Amount is required").positive("Enter a valid number").typeError("Amount must be a valid number"),remark:re()});function Te({open:u,onClose:r,onBudgetAdded:E,Bid:g,budgets:i}){const p=W(),[f,C]=l.useState(!0);l.useEffect(()=>{const m=localStorage.getItem("accessToken");if(!m){p("/auth/login");return}C(!0),S.get("http://localhost:3001/cate/viewAll",{headers:{accessToken:m}}).then(d=>{C(!1)}).catch(d=>{b(d)})},[p]);const b=m=>{const d=m.response&&m.response.data.message||m.message;console.error("Error:",d)},o=U({initialValues:{amount:(i==null?void 0:i.amount)||"",remark:(i==null?void 0:i.remark)||""},validationSchema:Ae,enableReinitialize:!0,onSubmit:m=>{S.patch(`http://localhost:3001/budget/edit/${g}`,m,{headers:{accessToken:localStorage.getItem("accessToken")}}).then(d=>{if(d.data){const y=d.data;E(y),o.resetForm(),r()}else b({message:"No Budget returned in response."})}).catch(d=>{b(d)})}});return e.createElement($,{open:u,onClose:r},e.createElement(k,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2}},e.createElement(h,{variant:"h6",component:"h2",gutterBottom:!0},"Edit Budget"),e.createElement(F,{onClick:r,sx:{position:"absolute",top:16,right:16}},e.createElement(z,null)),f?e.createElement(h,null,"Loading data, please wait..."):e.createElement("form",{onSubmit:o.handleSubmit,className:"formContainer"},e.createElement(w,{fullWidth:!0,margin:"normal"},e.createElement(L,{name:"amount",type:"number",label:"Amount",variant:"outlined",onChange:o.handleChange,value:o.values.amount,error:o.touched.amount&&!!o.errors.amount,helpertext:o.touched.amount&&o.errors.amount,inputProps:{"aria-label":"Amount"}})),e.createElement(w,{fullWidth:!0,margin:"normal"},e.createElement(L,{name:"remark",label:"Remark (optional)",variant:"outlined",onChange:o.handleChange,value:o.values.remark,inputProps:{"aria-label":"Remark"}})),e.createElement(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,startIcon:e.createElement(P,null)},"Edit"))))}const we={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,borderRadius:2};function Fe({open:u,onClose:r,onBudgetDeleted:E,budgetID:g}){const i=W(),[p,f]=l.useState(!1);l.useEffect(()=>{localStorage.getItem("accessToken")||i("/auth/login")},[i]);const C=o=>{const m=o.response&&o.response.data.message||o.message;Q("Error",m,"error")},b=async()=>{f(!0);try{const o=await S.delete(`http://localhost:3001/budget/dlt/${g}`,{headers:{accessToken:localStorage.getItem("accessToken")}});E(g),r()}catch(o){C(o)}finally{f(!1)}};return e.createElement($,{open:u,onClose:r},e.createElement(k,{sx:we},e.createElement(h,{variant:"h6",component:"h2",gutterBottom:!0},"Delete Budget"),e.createElement(F,{onClick:r,sx:{position:"absolute",top:16,right:16}},e.createElement(z,null)),e.createElement(h,null,"Are you sure you want to delete this Budget?"),e.createElement(k,{mt:2,display:"flex",justifyContent:"space-between"},e.createElement(I,{onClick:r,variant:"outlined",color:"secondary"},"Cancel"),e.createElement(I,{onClick:b,variant:"contained",color:"error",disabled:p},p?"Deleting...":"Delete"))))}function je(){const u=Ce();l.useState(!1);const[r,E]=l.useState(0),[g,i]=l.useState(0),[p,f]=l.useState([]),[C,b]=l.useState(""),[o,m]=l.useState(!1),[d,y]=l.useState(!1),[s,c]=l.useState(!1),[n,v]=l.useState(null),[D,N]=l.useState(null),x=W();l.useEffect(()=>{const t=localStorage.getItem("accessToken");if(!t){x("/auth/login");return}S.get("http://localhost:3001/budget/viewAll",{headers:{accessToken:t}}).then(a=>{a.data&&(console.log(a.data.totalAmount),E(isNaN(parseFloat(a.data.totalBudget))?0:parseFloat(a.data.totalBudget).toFixed(2)),i(isNaN(parseFloat(a.data.totalAmount))?0:parseFloat(a.data.totalAmount).toFixed(2)),f(a.data.budgetTrans))}).catch(a=>{b(a.message)})},[x]);const B=t=>{S.get("http://localhost:3001/budget/viewAll",{headers:{accessToken:localStorage.getItem("accessToken")}}).then(a=>{a.data&&(E(isNaN(parseFloat(a.data.totalBudget))?0:parseFloat(a.data.totalBudget).toFixed(2)),i(isNaN(parseFloat(a.data.totalAmount))?0:parseFloat(a.data.totalAmount).toFixed(2)),f(a.data.budgetTrans),Y("Successful!"))}).catch(a=>{b(a.message)})},R=(t,a)=>{N(a),v(t),y(!0)},M=t=>{v(t),c(!0)},_=()=>{m(!0)},ee=t=>{const a=p.find(A=>A.id===t);f(p.filter(A=>A.id!==t)),i(parseFloat(g-a.totalSpent).toFixed(2)),E(parseFloat(r-a.amount).toFixed(2)),Y("Deleted successfully!")},q="rgb(93,135,255)",H="rgb(236,242,255)",j="rgb(230, 255, 250)";return e.createElement(ae,{title:"Budgets",description:"this is Budgets"},e.createElement(oe,{title:"Budgets"},e.createElement(ye,{maxWidth:"lg"},e.createElement(X,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:4},e.createElement(h,{variant:"h4",fontWeight:"700"}),e.createElement(I,{variant:"contained",color:"primary",onClick:()=>_(),startIcon:e.createElement(P,{size:"20"}),sx:{borderRadius:"8px",textTransform:"none",boxShadow:3,"&:hover":{boxShadow:4}}},"New Budget")),e.createElement(T,{container:!0,spacing:3,mb:4},[{title:"Total Budget",amount:r,color:q,bgcolor:H},{title:"Total Spent",amount:g,color:u.palette.error.main,bgcolor:"rgb(255, 231, 217)"},{title:"Remaining Budget",amount:(r-g).toFixed(2),color:"rgb(0, 194, 146)",bgcolor:j}].map((t,a)=>e.createElement(T,{item:!0,xs:12,md:4,key:a},e.createElement(J,{elevation:3,sx:{bgcolor:t.bgcolor,transition:"transform 0.3s","&:hover":{transform:"translateY(-5px)"}}},e.createElement(K,null,e.createElement(h,{variant:"h6",gutterBottom:!0,color:"textSecondary"},t.title),e.createElement(h,{variant:"h4",color:t.color,sx:{fontWeight:"bold"}},"RM ",t.amount.toLocaleString())))))),e.createElement(T,{container:!0,spacing:3},p.length===0?e.createElement(T,{item:!0,xs:12},e.createElement(h,{variant:"h6",align:"center",color:"textSecondary"},"No Budget Available")):p.map((t,a)=>{const A=(t.totalSpent/t.amount*100).toFixed(1),te=t.totalSpent>=t.amount*.75,V={series:[t.totalSpent,Math.max(0,t.amount-t.totalSpent)],options:{chart:{type:"donut",height:200},labels:["Spent","Remaining"],colors:[te?u.palette.error.main:q,H],plotOptions:{pie:{donut:{size:"75%"}}},dataLabels:{enabled:!1},legend:{show:!1},stroke:{show:!1}}};return e.createElement(T,{item:!0,xs:12,md:6,lg:4,key:a},e.createElement(J,{elevation:3,sx:{transition:"transform 0.3s","&:hover":{transform:"translateY(-5px)"}}},e.createElement(Se,{title:t.remark?t.remark:t.Category.name,action:e.createElement(X,{direction:"row",spacing:1},e.createElement(F,{onClick:()=>R(t.id,t),size:"small"},e.createElement(ce,{size:18})),e.createElement(F,{onClick:()=>M(t.id),size:"small",color:"error"},e.createElement(ie,{size:18})))}),e.createElement(K,null,e.createElement(k,{display:"flex",justifyContent:"center",mb:2},e.createElement(ne,{options:V.options,series:V.series,type:"donut",width:"200px"})),e.createElement(h,{variant:"h6",align:"center",gutterBottom:!0},"RM ",t.totalSpent.toFixed(2).toLocaleString()," / RM ",t.amount.toLocaleString()),e.createElement(k,{display:"flex",alignItems:"center",justifyContent:"center"},e.createElement(ke,{sx:{bgcolor:j,width:24,height:24,mr:1}},e.createElement(me,{size:16,color:"#4caf50"})),e.createElement(h,{variant:"body2"},A,"% of budget used")))))})))),e.createElement(Be,{open:o,onClose:()=>m(!1),onBudgetAdded:B}),e.createElement(Te,{open:d,onClose:()=>y(!1),onBudgetAdded:B,Bid:n,budgets:D}),e.createElement(Fe,{open:s,onClose:()=>c(!1),onBudgetDeleted:ee,budgetID:n}))}export{je as default};
